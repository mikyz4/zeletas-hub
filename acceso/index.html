<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Acceso - Zeletas Hub</title>
</head>
<body>
    <h1>Acceso al Panel</h1>
    <button id="btnGoogle" style="padding: 20px; background: blue; color: white; border: none; border-radius: 8px; cursor: pointer;">
        ENTRAR CON GOOGLE
    </button>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
        // 1. COMPROBACIÓN INICIAL
        alert("Paso 1: El archivo HTML ha cargado el script.");

        const SUPABASE_URL = "https://sbqpkfdcznulwpxlxiwu.supabase.co";
        const SUPABASE_ANON_KEY = "sb_publishable_9dX-ESpW0YwCaFfDR0aMAg_9PLvO2oo";
        
        // Creamos el cliente usando la librería que acabamos de cargar
        const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // 2. FUNCIÓN PARA REVISAR SI YA HEMOS ENTRADO
        async function verificarSesion() {
            const { data: { session }, error } = await supabase.auth.getSession();
            
            if (session) {
                alert("Paso 2: ¡Sesión detectada para " + session.user.email + "!");
                // Limpiamos la URL (quita el token feo)
                window.history.replaceState({}, document.title, window.location.pathname);
                // Vamos al perfil
                window.location.href = "../perfil/index.html";
            } else {
                console.log("No hay sesión todavía.");
            }
        }

        // 3. BOTÓN PARA INICIAR EL LOGIN
        document.getElementById('btnGoogle').onclick = async () => {
            await supabase.auth.signInWithOAuth({
                provider: 'google',
                options: {
                    // Importante: Volver a esta misma carpeta para procesar el token
                    redirectTo: window.location.origin + window.location.pathname 
                }
            });
        };

        // Ejecutamos la verificación nada más cargar la página
        verificarSesion();
    </script>
</body>
</html>
