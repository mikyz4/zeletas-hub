<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil - Zeletas Hub</title>
  <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>

<section class="hero">
  <h2>Bienvenido a tu panel, <span id="nombreUsuario"></span></h2>

  <div class="perfil-info">
    <p><strong>Email:</strong> <span id="emailUsuario"></span></p>
    <p><strong>Estado de verificación:</strong> <span id="estadoUsuario"></span></p>
  </div>

  <div class="acciones">
    <button id="logoutBtn">Cerrar sesión</button>
    <a href="../mis-anuncios/">Mis anuncios</a>
    <a href="../mis-favoritos/">Favoritos</a>
    <a href="../mis-pedidos/">Pedidos</a>
    <a href="../mis-servicios/">Servicios</a>
    <a href="../mis-contratos/">Contratos</a>
    <a href="../soporte/">Soporte</a>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  // Inicializamos Supabase (usamos los mismos datos que en el index)
  const S_URL = "https://sbqpkfdcznulwpxlxiwu.supabase.co";
  const S_KEY = "sb_publishable_9dX-ESpW0YwCaFfDR0aMAg_9PLvO2oo";
  const supabaseClient = supabase.createClient(S_URL, S_KEY);

  const nombreUsuario = document.getElementById('nombreUsuario');
  const emailUsuario = document.getElementById('emailUsuario');
  const estadoUsuario = document.getElementById('estadoUsuario');
  const logoutBtn = document.getElementById('logoutBtn');

  async function cargarUsuario() {
    // Obtenemos la sesión actual
    const { data: { session } } = await supabaseClient.auth.getSession();

    if (session) {
      const user = session.user;
      nombreUsuario.textContent = user.user_metadata?.full_name || "Usuario";
      emailUsuario.textContent = user.email;
      estadoUsuario.textContent = user.email_confirmed_at ? 'Verificado' : 'No verificado';
    } else {
      // Si no hay sesión, mandamos al inicio (donde está el modal)
      window.location.href = "../index.html";
    }
  }

  // FUNCIÓN PARA CERRAR SESIÓN (Botón)
  if (logoutBtn) {
    logoutBtn.onclick = async (e) => {
      e.preventDefault();
      console.log("Cerrando sesión...");
      
      const { error } = await supabaseClient.auth.signOut();
      
      if (error) {
        alert("Error al salir: " + error.message);
      } else {
        // Al salir, volvemos a la página principal
        window.location.href = "../index.html";
      }
    };
  }

  // Ejecutar al cargar
  window.onload = cargarUsuario;
</script>
