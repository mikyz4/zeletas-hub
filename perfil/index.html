<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perfil - Zeletas Hub</title>
  <link rel="stylesheet" href="../assets/css/styles.css">
</head>
<body>

<section class="hero">
  <h2>Bienvenido a tu panel, <span id="nombreUsuario"></span></h2>

  <div class="perfil-info">
    <p><strong>Email:</strong> <span id="emailUsuario"></span></p>
    <p><strong>Estado de verificación:</strong> <span id="estadoUsuario"></span></p>
  </div>

  <div class="acciones">
    <button id="logoutBtn">Cerrar sesión</button>
    <a href="../mis-anuncios/">Mis anuncios</a>
    <a href="../mis-favoritos/">Favoritos</a>
    <a href="../mis-pedidos/">Pedidos</a>
    <a href="../mis-servicios/">Servicios</a>
    <a href="../mis-contratos/">Contratos</a>
    <a href="../soporte/">Soporte</a>
  </div>
</section>

<script type="module">
  // Importamos la conexión desde la ruta correcta
  import { supabase } from '../assets/js/supabase.js';

  const nombreUsuario = document.getElementById('nombreUsuario');
  const emailUsuario = document.getElementById('emailUsuario');
  const estadoUsuario = document.getElementById('estadoUsuario');
  const logoutBtn = document.getElementById('logoutBtn');

  async function cargarUsuario() {
    // Obtenemos el usuario actual
    const { data: { user }, error } = await supabase.auth.getUser();

    if (user) {
      // Google guarda el nombre en 'full_name'
      nombreUsuario.textContent = user.user_metadata?.full_name || user.email;
      emailUsuario.textContent = user.email;
      estadoUsuario.textContent = user.email_confirmed_at ? 'Verificado' : 'No verificado';
    } else {
      // Si no hay sesión, mandamos de vuelta al acceso
      window.location.href = '../acceso/';
    }
  }

  // Función para cerrar sesión
  logoutBtn.addEventListener('click', async () => {
    const { error } = await supabase.auth.signOut();
    window.location.href = '../acceso/';
  });

  // Iniciamos la carga
  cargarUsuario();
</script>

</body>
</html>
